ec.pkg("ec.shoppingCart");
ec.load("ajax", {
    loadType: "lazy"
});
ec.shoppingCart.isPrdPreferential = false;
ec.shoppingCart.isOrderPreferential = false;
function showOrderPrice(a, k, f, d) {
    var h = 0;
    if (a.find("td.tr-subtotal").length > 1) {
        for (var e = 0; e < a.find("td.tr-subtotal").length; e++) {
            h = h + parseFloat($(a.find("td.tr-subtotal").get(e)).children("b").text().substring(1))
        }
    } else {
        h = parseFloat(a.find("td.tr-subtotal").children("b").text().substring(1))
    }
    var b = parseFloat($("#sc-cartInfo-totalOriginalPrice").text().substring(1));
    var l = parseFloat($("#sc-cartInfo-totalPrice").text().substring(1));
    var j = parseFloat($("#sc-cartInfo-minusPrice").text().substring(1));
    var c = a.find("td.tr-subtotal").has("span").html();
    if (f) {
        if (d) {
            if (k) {
                b = b + h;
                if (j == 0) {
                    j = ec.shoppingCart.orderPreferentialPrice
                }
                if (c) {
                    var g = parseFloat(a.find("td.tr-subtotal").children("span").find("em").text().substring(1));
                    j = j + g;
                    b = b + g
                }
            } else {
                b = b - h;
                if (c) {
                    var g = parseFloat(a.find("td.tr-subtotal").children("span").find("em").text().substring(1));
                    j = j - g;
                    b = b - g
                }
            }
            l = (b - j > 0) ? (b - j) : 0;
            if (b == 0) {
                j = 0
            }
        } else {
            if (k) {
                l = l + h;
                b = b + h;
                if (c) {
                    var g = parseFloat(a.find("td.tr-subtotal").children("span").find("em").text().substring(1));
                    j = j + g;
                    b = b + g
                }
            } else {
                l = l - h;
                b = b - h;
                if (c) {
                    var g = parseFloat(a.find("td.tr-subtotal").children("span").find("em").text().substring(1));
                    j = j - g;
                    b = b - g
                }
            }
        }
    } else {
        if (d) {
            if (k) {
                l = l + h;
                b = b + h
            } else {
                l = l - h;
                b = b - h
            }
            j = ec.shoppingCart.preferentialPrice;
            l = (b - j > 0) ? (b - j) : 0;
            if (b == 0) {
                j = 0
            }
        } else {
            if (k) {
                l = l + h;
                b = b + h
            } else {
                l = l - h;
                b = b - h
            }
        }
    }
    $("#sc-cartInfo-totalOriginalPrice").html("&yen;" + b.toFixed(2));
    $("#sc-cartInfo-minusPrice").html("&yen;" + j.toFixed(2));
    $("#sc-cartInfo-totalPrice").html("&yen;" + l.toFixed(2))
}
ec.shoppingCart.check = function (d) {
    var a = $(d).closest("div");
    if (d.checked) {
        a.addClass("selected");
        a.find("input[id^='box-']").attr("checked", true);
        var b = true;
        $("#cart-list .tr-check input[id^='box-']").each(function (j) {
            if (!$(this).attr("checked")) {
                b = false
            }
        });
        if (b) {
            $("#checkAll-buttom,#checkAll-top").attr("checked", true)
        }
    } else {
        a.removeClass("selected");
        a.find("input[type=checkbox]").attr("checked", false);
        $("#checkAll-buttom,#checkAll-top").attr("checked", false);
        showOrderPrice(a, false, ec.shoppingCart.isPrdPreferential, ec.shoppingCart.isOrderPreferential)
    }
    var e = $("#cart-list input[name='skuIds']:checked");
    var c = $("#cart-list input[name='bundleIds']:checked");
    var h = [];
    var f = [];
    var g = [];
    var i = [];
    e.each(function () {
        var j = $(this).closest("tbody");
        var o = this.value;
        var n = $("#quantity-" + o, j).val();
        var l = $("#quantity-" + o, j).attr("data-type");
        if (n) {
            h.push(o);
            f.push(l);
            g.push(n);
            i.push("");
            var m = $('input[name="extendIds"]', j).val();
            if (m) {
                h.push(m);
                f.push(6);
                g.push(n);
                i.push(o)
            }
            var k = $('input[name="accidentIds"]', j).val();
            if (k) {
                h.push(k);
                f.push(7);
                g.push(n);
                i.push(o)
            }
        }
    });
    c.each(function () {
        var j = $(this).closest("tbody");
        var m = this.value;
        var l = $("#quantity-bundle-" + m, j).val();
        var k = $("#quantity-bundle-" + m, j).attr("data-type");
        if (l) {
            h.push(m);
            f.push(k);
            g.push(l);
            i.push("")
        }
    });
    if (h.length == 0) {
        $(".limitstock").hide();
        $(".timerpromo").hide()
    }
    $.ajax({
        url: domainMain + "/order/shoppingCart/cart.json",
        dataType: "jsonp",
        timeout: 10000,
        traditional: true,
        data: {
            sbs: h.join(","),
            types: f.join(","),
            qtys: g.join(","),
            ess: i.join(","),
            t: new Date().getTime()
        },
        success: function (k) {
            if (!k.success || !k.cartInfo) {
                return
            } else {
                ec.shoppingCart.modifyPrdNumAndPrice(k);
                var j = $("#cart-total-area");
                ec.shoppingCart.initPrice(j, k.cartInfo)
            }
        }
    })
};
ec.shoppingCart.checkAll = function (g) {
    if ($(g).attr("checked")) {
        $("#cart-list input[id^='box-']").attr("checked", true);
        $("#cart-list").children(".order-pro-area").addClass("selected");
        var a = $("#cart-list input[name='skuIds']:checked");
        var f = $("#cart-list input[name='bundleIds']:checked");
        var d = [];
        var b = [];
        var c = [];
        var e = [];
        a.each(function () {
            var h = $(this).closest("tbody");
            var m = this.value;
            var l = $("#quantity-" + m, h).val();
            var j = $("#quantity-" + m, h).attr("data-type");
            if (l) {
                d.push(m);
                b.push(j);
                c.push(l);
                e.push("");
                var k = $('input[name="extendIds"]', h).val();
                if (k) {
                    d.push(k);
                    b.push(6);
                    c.push(l);
                    e.push(m)
                }
                var i = $('input[name="accidentIds"]', h).val();
                if (i) {
                    d.push(i);
                    b.push(7);
                    c.push(l);
                    e.push(m)
                }
            }
        });
        f.each(function () {
            var h = $(this).closest("tbody");
            var k = this.value;
            var j = $("#quantity-bundle-" + k, h).val();
            var i = $("#quantity-bundle-" + k, h).attr("data-type");
            if (j) {
                d.push(k);
                b.push(i);
                c.push(j);
                e.push("")
            }
        });
        if (d.length == 0) {
            $(".limitstock").hide()
        }
        $.ajax({
            url: domainMain + "/order/shoppingCart/cart.json",
            dataType: "jsonp",
            timeout: 10000,
            traditional: true,
            data: {
                sbs: d.join(","),
                types: b.join(","),
                qtys: c.join(","),
                ess: e.join(","),
                t: new Date().getTime()
            },
            success: function (i) {
                if (!i.success || !i.cartInfo) {
                    return
                } else {
                    ec.shoppingCart.modifyPrdNumAndPrice(i);
                    var h = $("#cart-total-area");
                    ec.shoppingCart.initPrice(h, i.cartInfo)
                }
            }
        })
    } else {
        $("#cart-list input[type=checkbox]").attr("checked", false);
        $("#cart-list").children(".order-pro-area").removeClass("selected");
        $("#sc-cartInfo-totalOriginalPrice").html("&yen;0.00");
        $("#sc-cartInfo-minusPrice").html("&yen;0.00");
        $("#sc-cartInfo-totalPrice").html("&yen;0.00");
        $(".timerpromo").hide()
    }
};
ec.shoppingCart.confirm = function () {
    _paq.push(["trackLink", "\u8d2d\u7269\u8f66-\u53bb\u7ed3\u7b97", "link", " "]);
    ec.code.addAnalytics({
        hicloud: true
    });
    var a = $("#cart-list input[name='skuIds']:checked");
    var b = $("#cart-list input[name='bundleIds']:checked");
    if (a.length == 0 && b.length == 0) {
        alert("\u8bf7\u81f3\u5c11\u9009\u4e2d\u4e00\u4e2a\u5546\u54c1\uff01");
        return
    }
    if (!ec.shoppingCart._checkUnderstockAndLimitstock()) {
        return false
    }
    ec.binding.cart.withPhone(function () {
        ec.cart.jumpToConfirm(a, b)
    })
};
ec.shoppingCart._renderNum = function () {
    ec.ui.number("#cart-list input.shop-quantity", {
        max: 999,
        min: 1,
        minusBtn: '<a href="javascript:;" class="icon-minus-3 vam" title="\u51cf"><span>-</span></a>',
        plusBtn: '<a href="javascript:;" class="icon-plus-3 vam" title="\u52a0"><span>+</span></a>',
        onchange: function (e, b) {
            var d = $(this),
			a = d.attr("data-skuId"),
			c = d.attr("data-type");
            ec.shoppingCart._updateNum(a, c, b)
        }
    })
};
ec.shoppingCart._checkUnderstockAndLimitstock = function () {
    var d = true;
    var c = function (g) {
        return $(g).closest("table").find("input[type=checkbox]")
    };
    if ($(".understock").length > 0 || $(".limitstock").length > 0 || $(".quotastock").length > 0 || $(".timerpromo").length) {
        var f = $(".limitstock"),
		b = $(".understock"),
		a = $(".quotastock"),
		e = $(".timerpromo");
        if (f.length > 0) {
            f.each(function (g, h) {
                if (c(h).attr("checked")) {
                    d = false;
                    $("#tips-text-p").html("\u8d2d\u7269\u8f66\u5546\u54c1\u8fbe\u5230\u8d2d\u4e70\u4e0a\u9650\uff0c\u8bf7\u5904\u7406\u540e\u7ed3\u7b97");
                    return false
                }
            })
        } else {
            if (b.length > 0) {
                b.each(function (g, h) {
                    if (c(h).attr("checked")) {
                        d = false;
                        $("#tips-text-p").html("\u8d2d\u7269\u8f66\u6709\u5e93\u5b58\u4e0d\u8db3\u5546\u54c1\uff0c\u8bf7\u5904\u7406\u540e\u7ed3\u7b97");
                        return false
                    }
                })
            } else {
                if (a.length > 0) {
                    a.each(function (g, h) {
                        if (c(h).attr("checked")) {
                            d = false;
                            $("#tips-text-p").html("\u5185\u8d2d\u5546\u54c1\u5df2\u8d85\u51fa\u8d2d\u4e70\u9650\u5236\u914d\u989d\uff0c\u8bf7\u5904\u7406\u540e\u7ed3\u7b97");
                            return false
                        }
                    })
                } else {
                    if (e.length > 0) {
                        e.each(function (g, h) {
                            if (c(h).attr("checked")) {
                                d = false;
                                $("#tips-text-p").html("\u542b\u6709\u6d3b\u52a8\u672a\u5f00\u59cb\u6216\u8005\u5df2\u7ed3\u675f\u7684\u5546\u54c1\uff0c\u8bf7\u5904\u7406\u540e\u518d\u7ed3\u7b97");
                                return false
                            }
                        })
                    }
                }
            }
        }
    }
    if (d) {
        $("#sc-action-tips").addClass("hide")
    } else {
        $("#sc-action-tips").removeClass("hide")
    }
    return d
};
ec.shoppingCart._updateNum = function (a, c, b) {
    ec.ui.loading.show();
    ec.shoppingCart._arr = [];
    ec.shoppingCart.selectedPrdSkuId = a;
    ec.shoppingCart.selectedPrdSkuIdType = c;
    if ("1" == c || "8" == c) {
        $("#box-" + a).attr("checked", true)
    } else {
        if ("2" == c || "9" == c) {
            $("#box-bundle-" + a).attr("checked", true)
        }
    }
    $("#cart-list input[id^='box-']:checked").each(function () {
        var d = this;
        var e = {
            id: d.value,
            type: d.getAttribute("data-type")
        };
        ec.shoppingCart._arr.push(e)
    });
    new ec.ajax().submit({
        url: "/cart/updateNum.json",
        data: {
            types: c,
            sbs: a,
            qty: b,
            t: new Date().getTime()
        },
        timeout: 10000,
        timeoutFunction: function () {
            ec.ui.loading.hide();
            ec.shoppingCart._faultTolerant(a, c, b);
            alert("\u64cd\u4f5c\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")
        },
        errorFunction: function () {
            ec.ui.loading.hide();
            ec.shoppingCart._faultTolerant(a, c, b)
        },
        successFunction: function (j) {
            try {
                if (!j.success) {
                    ec.ui.loading.hide();
                    ec.shoppingCart._faultTolerant(a, c, b);
                    ec.showError(j);
                    return
                }
                ec.ui.loading.hide();
                var g = j.cart;
                var k = new Array();
                for (var h = 0; h < g.length; h++) {
                    var d = g[h];
                    var f = true;
                    if (d.skuId) {
                        if (!($("#box-" + d.skuId).is(":checked")) && d.productType != 6 && d.productType != 7) {
                            f = false
                        }
                    } else {
                        if (d.bundleId) {
                            if (!($("#box-bundle-" + d.bundleId).is(":checked"))) {
                                f = false
                            }
                        }
                    }
                    if (f) {
                        k.push(d)
                    }
                }
                ec.cart.refreshCartTable(k, true, true)
            } catch (l) {
                ec.shoppingCart._faultTolerant(a, c, b)
            }
        }
    })
};
ec.shoppingCart._faultTolerant = function (a, e, d) {
    var b = null;
    if (e == 2 || e == 9) {
        b = $("#quantity-bundle-" + a)
    } else {
        b = $("#quantity-" + a)
    }
    var c = parseInt(b.val()) - d;
    if (b != null) {
        b.data("ovalue", c);
        b.val(c)
    }
};
ec.shoppingCart._renderInventory = function (d, a, f, c, g, b) {
    var e = function (h, j, i) {
        if (h && h.length > 0) {
            $(j + h.join("," + j), "#cart-form").html(i).show()
        }
    };
    e(b, ".timerpromo-", '<div class="sc-stock-tips timerpromo"><div class="tips-style-1 tips-area"><i></i><div class="tips-text"><p>\u6d3b\u52a8\u672a\u5f00\u59cb\u6216\u5df2\u7ecf\u7ed3\u675f</p></div><u></u></div></div>');
    e(g, ".timerpromo-", '<div class="sc-stock-tips timerpromo"><div class="tips-style-1 tips-area"><i></i><div class="tips-text"><p>\u6d3b\u52a8\u672a\u5f00\u59cb\u6216\u5df2\u7ecf\u7ed3\u675f</p></div><u></u></div></div>');
    e(d, ".understock-", '<s class="understock"></s>');
    e(a, ".limitstock-", '<div class="p-tips limitstock"><div class="tips-style-1 tips-area"><i></i><div class="tips-text"><p>\u8fbe\u5230\u8d2d\u4e70\u4e0a\u9650</p></div></div></div>');
    e(a, ".normalLimitstock-", '<div class="sc-stock-tips limitstock"><div class="tips-style-1 tips-area"><i></i>	<div class="tips-text"><p>\u8fbe\u5230\u8d2d\u4e70\u4e0a\u9650</p></div>	<u></u></div></div>');
    e(f, ".ngs-normalLimitstock-", '<div class="sc-stock-tips quotastock"><div class="tips-style-1 tips-area"><i></i>	<div class="tips-text"><p>\u8fbe\u5230\u8d2d\u4e70\u4e0a\u9650</p></div>	<u></u></div></div>');
    e(c, ".ngb-normalLimitstock-", '<div class="sc-stock-tips quotastock"><div class="tips-style-1 tips-area"><i></i>	<div class="tips-text"><p>\u8fbe\u5230\u8d2d\u4e70\u4e0a\u9650</p></div>	<u></u></div></div>')
};
ec.shoppingCart._renderColorAndVersion = function () {
    $(".p-sku em.p-spite-sku").each(function () {
        var g = $(this);
        var h = g.parent();
        var j = g.html();
        var a = j.split("~");
        var b = "",
		e = "",
		f = "";
        for (var c = 0, d = a.length; c < d; c++) {
            var k = $.trim(a[c]);
            if (k.startWith("\u989c\u8272")) {
                b = k
            } else {
                if (k.startWith("\u7248\u672c")) {
                    e = k
                }
            }
        }
        if (e) {
            f = "<em>" + e + "</em>"
        }
        if (b) {
            f = f + "<em>" + b + "</em>"
        }
        h.html(f)
    })
};
ec.shoppingCart.del = function (f, g, c, e) {
    if (!g && $("#cart-list input[name='skuIds']:checked").length == 0 && $("#cart-list input[name='bundleIds']:checked").length == 0) {
        alert("\u8bf7\u9009\u62e9\u60a8\u8981\u5220\u9664\u7684\u5546\u54c1\uff01");
        return
    }
    if (!ec.ui.confirm(f, g ? "\u60a8\u786e\u8ba4\u8981\u5220\u9664\u8be5\u5546\u54c1\u5417\uff1f" : "\u60a8\u786e\u8ba4\u8981\u5220\u9664\u8fd9\u4e9b\u5546\u54c1\u5417\uff1f")) {
        return
    }
    var d = {};
    if (g) {
        d.sbs = g.toString();
        d.types = c;
        if (d.types === undefined) {
            d.types = "1"
        } else {
            d.types = c.toString()
        }
        if (e) {
            d.ess = e
        }
    } else {
        var b = [];
        var a = [];
        $("#cart-list input[name='skuIds']:checked").each(function () {
            b.push(this.value);
            a.push(this.getAttribute("data-type"))
        });
        $("#cart-list input[name='bundleIds']:checked").each(function () {
            b.push(this.value);
            a.push(this.getAttribute("data-type"))
        });
        d.sbs = b.join(",");
        d.types = a.join(",")
    }
    ec.cart.del(d, function (j) {
        var h = ec.util.cookie.get("cart-recover") || ",",
		k = function (r, o, l) {
		    var n = h.indexOf("," + r + ";");
		    if (n == -1) {
		        h += r + ";" + o + ","
		    } else {
		        var m = h.substring(n + r.toString().length + 2, h.indexOf(",", n + 1));
		        o += parseInt(m);
		        h = h.replace("," + r + ";" + m + ",", "," + r + ";" + o + ",")
		    }
		},
		i = function (n, l) {
		    if (l == "2" || l == "9") {
		        var m = parseInt($("#quantity-bundle-" + n).val(), 10);
		        $("#order-pro-bundle-" + n + " input[name=skuIds]").each(function () {
		            k(this.value, m, l)
		        })
		    } else {
		        var m = parseInt($("#quantity-" + n).val(), 10);
		        $("#order-pro-" + n + " input[name=skuIds]").each(function () {
		            k(this.value, m, l)
		        })
		    }
		};
        if (g) {
            i(g, c)
        } else {
            $("input[name=bundleIds]:checked,input[name=skuIds]:checked", "#cart-form").each(function () {
                i(this.value, this.getAttribute("data-type"))
            })
        }
        ec.cart.setRecover(h);
        ec.cart.refreshCartTable(j.cart);
        ec.cart.refreshRecover()
    })
};
ec.cart.readd = function (a, d) {
    var c = function () {
        ec.cart.removeSkuFromRecover(a, function (e) {
            if (!e || e.length < 3) {
                $("#pro-recover-area").hide()
            }
        })
    };
    if ($("#box-" + a).length > 0) {
        ec.shoppingCart._updateNum(a, 1, d);
        c();
        ec.cart.refreshRecover();
        $("#pro-recommend-area").empty();
        ec.cart.initRecommend()
    } else {
        var b = {
            skuIds: [a],
            quantity: [d],
            type: [1]
        };
        ec.cart.add(b, {
            successFunction: function (e) {
                c();
                ec.cart.refreshCartTable(e.cart);
                ec.cart.refreshRecover()
            },
            errorFunction: function (e) {
                alert(e.msg)
            }
        })
    }
};
ec.cart.slider = {
    size: 0,
    index: 0,
    prev: function (a) {
        if (this.index <= 0 || this.size < 6) {
            return
        }
        this.index--;
        $("#pro-recommend-list").animate({
            left: -193 * this.index
        }, 1000);
        $("#cart-img-next").attr("class", "pro-scroller-forward");
        if (this.index == 0) {
            $("#cart-img-prev").attr("class", "pro-scroller-back-disabled")
        }
    },
    next: function (a) {
        if (this.index + 5 >= this.size || this.size < 6) {
            return
        }
        this.index++;
        $("#pro-recommend-list").animate({
            left: -193 * this.index
        }, 1000);
        $("#cart-img-prev").attr("class", "pro-scroller-back");
        if (this.index + 5 == this.size) {
            $("#cart-img-next").attr("class", "pro-scroller-forward-disabled")
        }
    }
};
ec.cart.refreshRecover = function () {
    $("#pro-recover-area").hide();
    var a = ec.util.cookie.get("cart-recover");
    if (a) {
        a = a.split(",");
        var e = {},
		c,
		b = [];
        for (var d = 1; d < a.length - 1; d++) {
            c = a[d].split(";");
            b.push(c[0]);
            e[c[0]] = c[1]
        }
        if (b.length > 0) {
            $.ajax({
                url: domainMain + "/product/queryInfo.json?skuId=" + b.join("&skuId=") + "&t=" + new Date().getTime(),
                dataType: "jsonp",
                timeout: 10000,
                success: function (j) {
                    if (!j.success) {
                        return
                    }
                    var h = [],
					k = [],
					m,
					l;
                    var f = ec.util.cookie.get("cart-foldingDoor");
                    for (var g = 0; g < j.data.length; g++) {
                        m = j.data[g];
                        l = parseInt(e[m.skuId], 10);
                        if (g == 0) {
                            k.push('<tr id="pro-recover-');
                            k.push(m.skuId);
                            k.push('"><td class="tr-pro"><a href="');
                            k.push(domainMain);
                            k.push("/product/");
                            k.push(m.prdId);
                            k.push(".html#");
                            k.push(m.skuId);
                            k.push('" target="_blank" title="');
                            k.push(m.name);
                            k.push('">');
                            k.push(m.name);
                            k.push("</a></td>");
                            k.push('<td class="tr-quantity">');
                            k.push(l + "</td>");
                            k.push('<td class="tr-subtotal">&yen;');
                            k.push(l * m.price);
                            k.push("</td>");
                            k.push('<td class="tr-operate"><a class="button-style-4 button-re-purchase" title="\u91cd\u65b0\u8d2d\u4e70" href="javascript:;" onclick="ec.cart.readd(');
                            k.push(m.skuId);
                            k.push(" , ");
                            k.push(l);
                            k.push(');return false;">\u91cd\u65b0\u8d2d\u4e70</a></td></tr>')
                        }
                        h.push('<tr id="pro-recover-');
                        h.push(m.skuId);
                        h.push('"><td class="tr-pro"><a href="');
                        h.push(domainMain);
                        h.push("/product/");
                        h.push(m.prdId);
                        h.push(".html#");
                        h.push(m.skuId);
                        h.push('" target="_blank" title="');
                        h.push(m.name + '">');
                        h.push(m.name);
                        h.push("</a></td>");
                        h.push('<td class="tr-quantity">');
                        h.push(l);
                        h.push("</td>");
                        h.push('<td class="tr-subtotal">&yen;');
                        h.push(l * m.price);
                        h.push("</td>");
                        h.push('<td class="tr-operate"><a class="button-style-4 button-re-purchase" title="\u91cd\u65b0\u8d2d\u4e70" href="javascript:;" onclick="ec.cart.readd(');
                        h.push(m.skuId);
                        h.push(" , ");
                        h.push(l);
                        h.push(');return false;">\u91cd\u65b0\u8d2d\u4e70</a></td></tr>')
                    }
                    if (j.data.length == 1) {
                        $("#pro-delete-shop-start").hide();
                        $("#pro-delete-shop-end").hide();
                        $("#pro-recover-tb").html(k.join(""))
                    } else {
                        if (!f || f == "doorClose") {
                            $("#pro-delete-shop-start").show();
                            $("#pro-delete-shop-end").hide();
                            $("#pro-recover-tb").html(k.join(""))
                        } else {
                            if (f == "doorOpen") {
                                $("#pro-delete-shop-start").hide();
                                $("#pro-delete-shop-end").show();
                                $("#pro-recover-tb").html(h.join(""))
                            }
                        }
                        $("#pro-delete-shop-start").unbind("click").bind("click", function () {
                            ec.util.cookie.set("cart-foldingDoor", "doorOpen");
                            $("#pro-delete-shop-start").hide();
                            $("#pro-delete-shop-end").show();
                            $("#pro-recover-tb").html(h.join(""))
                        });
                        $("#pro-delete-shop-end").unbind("click").bind("click", function () {
                            ec.util.cookie.set("cart-foldingDoor", "doorClose");
                            $("#pro-delete-shop-start").show();
                            $("#pro-delete-shop-end").hide();
                            $("#pro-recover-tb").html(k.join(""))
                        })
                    }
                    $("#pro-recover-area").show()
                }
            })
        }
    }
};
ec.cart.initRecommend = function () {
    var a = [];
    $("input[name=skuIds]", "#cart-form").each(function () {
        a.push(this.value)
    });
    if (a.length > 0) {
        $.ajax({
            url: domainMain + "/product/recommend.json?skuIds=" + a.join("&skuIds=") + "&t=" + new Date().getTime(),
            dataType: "jsonp",
            timeout: 10000,
            success: function (e) {
                if (!e.success || !e.data || e.data.length == 0) {
                    return
                }
                var b = e.data.length;
                ec.cart.slider.size = b;
                var d = [],
				f;
                for (var c = 0; c < b; c++) {
                    f = e.data[c];
                    d.push("<li><div>");
                    d.push('<p class="p-img"><a title="' + f.name);
                    d.push('"  target="_blank" href="' + domainMain + "/product/");
                    d.push(f.prdId + ".html#" + f.skuId);
                    d.push('"><img alt="' + f.name + '" src="');
                    d.push(ec.mediaPath + f.photoPath + "142_142_");
                    d.push(f.photoName + '"></a></p>');
                    d.push('<p class="p-name"><a title="' + f.name);
                    d.push('" target="_blank" href="' + domainMain + "/product/");
                    d.push(f.prdId + ".html#" + f.skuId + '">');
                    d.push(f.name + "</a></p>");
                    d.push('<p class="p-price"><b>\u00a5' + f.price);
                    d.push("</b></p>");
                    d.push('<p class="p-button"><a class="button-style-4 button-add-cart-3" href="javascript:;" title="\u52a0\u5165\u8d2d\u7269\u8f66" onclick="ec.cart.readd(');
                    d.push(f.skuId);
                    d.push(' , 1);return false;">\u52a0\u5165\u8d2d\u7269\u8f66</a></p>');
                    d.push("</div></li>")
                }
                $("#pro-recommend-area").show();
                if (b > 5) {
                    $("#cart-img-next").attr("class", "pro-scroller-forward")
                }
                $("#pro-recommend-list").width(193 * b).html(d.join(""));
                d = null
            }
        })
    }
};
ec.cart.buildCoupon = function (a) {
    var c = [];
    c.push('<tr><td class="tr-gift"><div class="gift-area"><dl><dt>');
    c.push(a.name);
    c.push("<em>\u6709\u6548\u671f\uff08");
    c.push(a.beginDate);
    c.push("\u81f3");
    c.push(a.endDate);
    c.push("\uff09</em></dt><dd>\u5546\u5bb6\u6d3b\u52a8\uff1a");
    c.push(a.promoCampaignName);
    c.push('</dd></dl><i></i><s class="understock-');
    c.push(a.premiumsSkuId);
    c.push(' hide"></s></div></td><td class="tr-quantity"><p><b>1</b>&nbsp;\u5f20</p></td></tr>');
    var b = $(c.join(""));
    c = null;
    return b
};
ec.cart.buildPremium = function (a) {
    var c = [];
    c.push('<tr><td class="tr-gift"><div class="gift-area"><dl><dt>');
    c.push(a.premiumsName);
    c.push("</dt><dd>\u5546\u5bb6\u6d3b\u52a8\uff1a");
    c.push(a.promoCampaignName);
    c.push('</dd><dd class="understock-');
    c.push(a.premiumsSkuId);
    c.push(' hide"></dd></dl><i></i></div></td><td class="tr-quantity"><p><b>1</b>&nbsp;\u4e2a</p></td></tr>');
    var b = $(c.join(""));
    c = null;
    return b
};
ec.cart.buildCartGift = function (b, d) {
    var g = $('<div class="hr-20"></div><div id="cart-gift-area" class="order-gift-list"><table border="0" cellpadding="0" cellspacing="0"><tbody id="cart-gift-list"></tbody></table></div>');
    var c = $("#cart-gift-list", g);
    for (var e = 0; e < b.length; ++e) {
        var a = b[e];
        var h = ec.cart.buildCoupon(a);
        c.append(h)
    }
    for (var e = 0; e < d.length; ++e) {
        var j = d[e];
        var f = ec.cart.buildPremium(j);
        c.append(f)
    }
    return g
};
ec.cart.buildTotalArea = function (b) {
    var c = [];
    c.push('<div class="hr-20"></div><div id="cart-total-area" class="sc-total-area clearfix"><div class="sc-total-control"><input id="checkAll-buttom" type="checkbox" name="" class="vam" autocomplete="off" checked /><label class="vam" for="checkAll-buttom">\u5168\u9009</label><a class="vam" href="javascript:;" seed="cart-all-del">\u5220\u9664\u9009\u4e2d\u5546\u54c1</a></div><div class="sc-total-price"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><th>\u603b\u8ba1\u91d1\u989d\uff1a</th><td id="sc-cartInfo-totalOriginalPrice">&yen;');
    c.push(b.totalOriginalPrice.toFixed(2));
    c.push('</td></tr><tr><th>\u5171\u8282\u7701\uff1a</th><td id="sc-cartInfo-minusPrice">&yen;');
    c.push((b.totalOriginalPrice - b.totalPrice).toFixed(2));
    c.push('</td></tr><tr><th><em>\u5408\u8ba1(\u4e0d\u542b\u8fd0\u8d39)\uff1a<em></th><td><b id="sc-cartInfo-totalPrice">&yen;');
    c.push(b.totalPrice.toFixed(2));
    c.push('<b></td></tr></tbody></table></div></div><div class="hr-25"></div><div class="sc-action-area clearfix"><a class="button-style-4 button-go-shopping-3" href="' + domainMain + '">\u7ee7\u7eed\u8d2d\u7269</a><a class="button-style-1 button-go-checkout-2" href="javascript:;" seed="cart-pay">\u53bb\u7ed3\u7b97</a><div class="sc-action-tips hide" id="sc-action-tips"><div class="tips-style-1 tips-area"><i></i><div class="tips-text"><p id="tips-text-p">\u8d2d\u7269\u8f66\u4e2d\u6709\u5e93\u5b58\u4e0d\u8db3\u5546\u54c1\uff0c\u8bf7\u5904\u7406\u540e\u7ed3\u7b97</p></div><s></s></div></div></div>');
    var a = $(c.join(""));
    return a
};
ec.cart.refreshCartTable = function (c, a, b) {
    if (b) {
        ec.cart.getCartInfo(c, ec.shoppingCart.modifyPrdNumAndPrice)
    } else {
        $("#cart-form").remove();
        $("div.sc-pro-list").nextUntil("#cart-empty-msg").remove();
        $("#cart-empty-msg").addClass("hide");
        $("#checkAll-top").attr("checked", true);
        if (a) {
            ec.cart.getCartInfo(c, ec.cart.initCartTable)
        } else {
            $("#pro-recommend-area").hide();
            ec.cart.getCartInfo(c, ec.cart.initCartTableAndRecommend)
        }
    }
};
ec.shoppingCart.modifyPrdNumAndPrice = function (g) {
    if (g.cartInfo.bundlerList) {
        for (var o = 0; o < g.cartInfo.bundlerList.length; o++) {
            var h = g.cartInfo.bundlerList[o];
            if (h.bundleId == ec.shoppingCart.selectedPrdSkuId && (ec.shoppingCart.selectedPrdSkuIdType == "2" || ec.shoppingCart.selectedPrdSkuIdType == "9")) {
                $("#quantity-bundle-" + ec.shoppingCart.selectedPrdSkuId).val(h.quantity);
                ec.shoppingCart.modifyPrice("#order-pro-bundle-" + ec.shoppingCart.selectedPrdSkuId, h.bundlePrice * h.quantity, h.preferentialPrice);
                break
            }
        }
    }
    if (g.cartInfo.productList) {
        for (var o = 0; o < g.cartInfo.productList.length; o++) {
            var a = g.cartInfo.productList[o];
            if (a.skuId == ec.shoppingCart.selectedPrdSkuId && (ec.shoppingCart.selectedPrdSkuIdType == "1" || ec.shoppingCart.selectedPrdSkuIdType == "8")) {
                var f = a.quantity;
                var e = a.skuPrice * f;
                var m = (a.ecshopPrice - a.skuPrice) * f;
                $("#quantity-" + ec.shoppingCart.selectedPrdSkuId).val(a.quantity);
                ec.shoppingCart.modifyPrice("#order-pro-" + ec.shoppingCart.selectedPrdSkuId, e, m);
                if (a.extendList.length > 0) {
                    var r = $("#order-pro-" + ec.shoppingCart.selectedPrdSkuId).find("tr.sc-pro-gift-item");
                    for (var n = 0; n < a.extendList.length; n++) {
                        var q = a.extendList[n];
                        var l = q.skuPrice;
                        var d = r.find('td.tr-pro input[value="' + q.skuId + '"]');
                        d.closest("tr").find("td.tr-subtotal").html("<b>&yen;" + (l * f).toFixed(2) + "</b>")
                    }
                }
                if (a.accidentList.length > 0) {
                    var r = $("#order-pro-" + ec.shoppingCart.selectedPrdSkuId).find("tr.sc-pro-gift-item");
                    for (var n = 0; n < a.accidentList.length; n++) {
                        var c = a.accidentList[n];
                        var l = c.skuPrice;
                        var d = r.find('td.tr-pro input[value="' + c.skuId + '"]');
                        d.closest("tr").find("td.tr-subtotal").html("<b>&yen;" + (l * f).toFixed(2) + "</b>")
                    }
                }
                break
            }
        }
    }
    var p = g.cartInfo;
    if (!ec.shoppingCart.checkResultData(p)) {
        return false
    }
    ec.shoppingCart.packageDate(g, p);
    var k = $("#cart-list");
    var s = $("#cart-total-area");
    ec.shoppingCart.repeatCalculatePriceByCheckbox(k, s, p);
    $("div.limitstock").remove();
    $("div.quotastock").remove();
    $("s.understock").remove();
    $("div.timerpromo").remove();
    $("#sc-action-tips").addClass("hide");
    var t = p.couponList;
    var b = p.premiumsList;
    if ($("#cart-gift-area").length > 0) {
        $("#cart-gift-area").prev().andSelf().remove()
    }
    ec.shoppingCart._renderColorAndVersion();
    ec.shoppingCart._renderInventory(g.lowStockSkuIds, g.beyondLimitSkuIds, g.beyondQuotaSkuIds, g.beyondQuotaBundleIds, g.beyondTimerPromo, g.beyondTimerPromobundler)
};
ec.shoppingCart.modifyPrice = function (b, d, a) {
    var c = [];
    c.push("<b>&yen;" + d.toFixed(2) + "</b>");
    if (a != 0) {
        c.push("<span><i>\u7701</i><em>&yen; " + a.toFixed(2) + "</em></span>")
    }
    $(b).find("td.tr-subtotal").html(c.join(""))
};
ec.shoppingCart.checkResultData = function (b) {
    var a = true;
    if (b) {
        if ((!b.bundlerList || (b.bundlerList && b.bundlerList.length == 0)) && (!b.productList || (b.productList && b.productList.length == 0))) {
            $("#cart-empty-msg").removeClass("hide");
            a = false
        }
    } else {
        $("#cart-empty-msg").removeClass("hide");
        a = false
    }
    return a
};
ec.shoppingCart.packageDate = function (a, b) {
    ec.cart.convertDataStructure(a);
    ec.shoppingCart.getPreferentialPrice(b);
    ec.shoppingCart.getGlobleParamer(b)
};
ec.cart.convertDataStructure = function (a) {
    if (a.cartInfo.bundlerList) {
        for (var e = 0; e < a.cartInfo.bundlerList.length; e++) {
            var b = a.cartInfo.bundlerList[e];
            for (var d = 0; d < b.skuList.length; d++) {
                var h = b.skuList[d];
                h.preferentialPrice = h.skuPrice - h.discountPrice;
                for (var c = 0; c < h.giftList.length; c++) {
                    var g = h.giftList[c];
                    g.id = g.giftId;
                    g.skuId = g.giftSkuId;
                    g.prdSkuName = g.giftName
                }
            }
        }
    }
    if (a.cartInfo.productList) {
        for (var e = 0; e < a.cartInfo.productList.length; e++) {
            var f = a.cartInfo.productList[e];
            f.preferentialPrice = f.skuPrice;
            f.skuPrice = f.ecshopPrice;
            for (var c = 0; c < f.giftList.length; c++) {
                var g = f.giftList[c];
                g.id = g.giftId;
                g.skuId = g.giftSkuId;
                g.prdSkuName = g.giftName
            }
        }
    }
    a.lowStockSkuIds = a.understock;
    a.beyondLimitSkuIds = a.limitstock;
    a.beyondQuotaSkuIds = a.sQuotastock;
    a.beyondQuotaBundleIds = a.bQuotastock;
    a.beyondTimerPromo = a.timerpromo;
    a.beyondTimerPromobundler = a.timerpromoBund
};
ec.shoppingCart.getPreferentialPrice = function (a) {
    if (a.preferentialPrice) {
        ec.shoppingCart.preferentialPrice = a.preferentialPrice;
        if (a.orderDisPrice) {
            if (a.orderDisPrice == a.preferentialPrice) {
                ec.shoppingCart.preferentialPrice = 0;
                ec.shoppingCart.isPrdPreferential = false;
                ec.shoppingCart.isOrderPreferential = false
            } else {
                ec.shoppingCart.preferentialPrice = a.preferentialPrice - a.orderDisPrice;
                ec.shoppingCart.isPrdPreferential = true;
                ec.shoppingCart.isOrderPreferential = false
            }
        } else {
            ec.shoppingCart.isPrdPreferential = true;
            ec.shoppingCart.isOrderPreferential = false
        }
    } else {
        ec.shoppingCart.preferentialPrice = 0;
        ec.shoppingCart.isPrdPreferential = false;
        ec.shoppingCart.isOrderPreferential = false
    }
    ec.shoppingCart.orderPreferentialPrice = 0;
    ec.shoppingCart.totalOriginalPrice = a.totalOriginalPrice;
    ec.shoppingCart.totalPrice = a.totalPrice
};
ec.shoppingCart.getGlobleParamer = function (a) {
    var d = $("#globleParameter");
    var c = domainMain + d.attr("context");
    var b = d.attr("mediaPath");
    a.context = c;
    a.mediaPath = b
};
ec.shoppingCart.createShoppingCart = function (f, b, d) {
    f.html(ec.shoppingCart._template.parse("product-list", d));
    var g = d.couponList;
    var a = d.premiumsList;
    var c = $('<form id="cart-form" autocomplete="off" method="get"></form>').submit(ec.shoppingCart.confirm).append('<input type="hidden" name="state" value="1"/>').append(f);
    var e = $("div.sc-pro-list");
    e.append(c).after(b)
};
ec.shoppingCart.addButtonEventandCheckbox = function () {
    $("#checkAll-top").click(function () {
        $("#checkAll-buttom").attr("checked", this.checked);
        ec.shoppingCart.checkAll(this)
    });
    $("#checkAll-buttom").click(function () {
        $("#checkAll-top").attr("checked", this.checked);
        ec.shoppingCart.checkAll(this)
    });
    $(".sc-total-control a").click(function () {
        ec.shoppingCart.del(this)
    });
    $(".sc-action-area a.button-go-checkout-2").click(ec.shoppingCart.confirm)
};
ec.shoppingCart.initPrice = function (m, e) {
    var b = 0;
    var o = 0;
    var h = 0;
    for (var d = 0; d < e.bundlerList.length; d++) {
        var p = e.bundlerList[d];
        b += p.originalPrice * p.quantity;
        h += p.preferentialPrice
    }
    for (var l = 0; l < e.productList.length; l++) {
        var n = e.productList[l];
        var c = n.quantity;
        b += n.ecshopPrice * c;
        h += (n.ecshopPrice - (n.preferentialPrice ? n.preferentialPrice : n.skuPrice)) * c;
        if (n.extendList.length > 0) {
            for (var k = 0; k < n.extendList.length; k++) {
                var g = n.extendList[k];
                var f = g.skuPrice;
                b += f * c
            }
        }
        if (n.accidentList.length > 0) {
            for (var i = 0; i < n.accidentList.length; i++) {
                var a = n.accidentList[i];
                var f = a.skuPrice;
                b += f * c
            }
        }
    }
    o = b - h;
    m.find("#sc-cartInfo-totalOriginalPrice").html("&yen;" + b.toFixed(2));
    m.find("#sc-cartInfo-minusPrice").html("&yen;" + h.toFixed(2));
    m.find("#sc-cartInfo-totalPrice").html("&yen;" + o.toFixed(2))
};
ec.shoppingCart.repeatCalculatePriceByCheckbox = function (n, B, t) {
    if (ec.shoppingCart._arr) {
        B.find("#sc-cartInfo-totalOriginalPrice").html("&yen;0.00");
        B.find("#sc-cartInfo-minusPrice").html("&yen;0.00");
        B.find("#sc-cartInfo-totalPrice").html("&yen;0.00");
        n.find(":checkbox").attr("checked", false);
        B.find(":checkbox").attr("checked", false);
        var w = false;
        var l = 0;
        var c = 0;
        var q = 0;
        var o = t.bundlerList.length;
        var e = t.productList.length;
        for (var s = 0; s < ec.shoppingCart._arr.length; s++) {
            var v = ec.shoppingCart._arr[s];
            var b = v.type;
            if (v.id == ec.shoppingCart.selectedPrdSkuId && ec.shoppingCart.selectedPrdSkuIdType == v.type) {
                w = true
            }
        }
        if (!w) {
            ec.shoppingCart._arr.push({
                id: ec.shoppingCart.selectedPrdSkuId,
                type: ec.shoppingCart.selectedPrdSkuIdType
            })
        }
        for (var s = 0; s < ec.shoppingCart._arr.length; s++) {
            var v = ec.shoppingCart._arr[s];
            var b = v.type;
            var u = null;
            if (b == "2" || b == "9") {
                for (var r = 0; r < t.bundlerList.length; r++) {
                    var m = t.bundlerList[r];
                    if (m.bundleId == v.id) {
                        l += m.originalPrice * m.quantity;
                        q += m.preferentialPrice;
                        break
                    }
                }
                u = n.find("#box-bundle-" + v.id)
            } else {
                for (var k = 0; k < t.productList.length; k++) {
                    var a = t.productList[k];
                    var f = a.quantity;
                    if (a.skuId == v.id) {
                        l += a.skuPrice * f;
                        q += (a.ecshopPrice - a.preferentialPrice) * f;
                        if (a.extendList.length > 0) {
                            for (var h = 0; h < a.extendList.length; h++) {
                                var A = a.extendList[h];
                                var p = A.skuPrice;
                                l += p * f
                            }
                        }
                        if (a.accidentList.length > 0) {
                            for (var g = 0; g < a.accidentList.length; g++) {
                                var d = a.accidentList[g];
                                var p = d.skuPrice;
                                l += p * f
                            }
                        }
                        break
                    }
                }
                u = n.find("#box-" + v.id)
            }
            u.attr("checked", true)
        }
        if ((o + e) == ec.shoppingCart._arr.length) {
            $("#checkAll-buttom,#checkAll-top").attr("checked", true)
        }
        q += ec.shoppingCart.orderPreferentialPrice;
        c = l - q;
        B.find("#sc-cartInfo-totalOriginalPrice").html("&yen;" + l.toFixed(2));
        B.find("#sc-cartInfo-minusPrice").html("&yen;" + q.toFixed(2));
        B.find("#sc-cartInfo-totalPrice").html("&yen;" + c.toFixed(2));
        ec.shoppingCart._arr = null
    }
};
ec.cart.initCartTable = function (b) {
    var c = b.cartInfo;
    if (!ec.shoppingCart.checkResultData(c)) {
        return false
    }
    var d = $('<span id="cart-list"></span>');
    var a = ec.cart.buildTotalArea(c);
    ec.shoppingCart.initPrice(a, c);
    ec.shoppingCart.packageDate(b, c);
    ec.shoppingCart.createShoppingCart(d, a, c);
    ec.shoppingCart.addButtonEventandCheckbox();
    ec.shoppingCart.repeatCalculatePriceByCheckbox(d, a, c);
    ec.shoppingCart._renderNum();
    ec.shoppingCart._renderColorAndVersion();
    ec.shoppingCart._renderInventory(b.lowStockSkuIds, b.beyondLimitSkuIds, b.beyondQuotaSkuIds, b.beyondQuotaBundleIds, b.beyondTimerPromo, b.beyondTimerPromobundler);
    return true
};
ec.cart.initCartTableAndRecommend = function (a) {
    if (ec.cart.initCartTable(a)) {
        ec.cart.initRecommend()
    }
};
ec.ready(function () {
    ec.shoppingCart.preferentialPrice = 0;
    ec.shoppingCart._template = new ec.template($("#product-list-html").val());
    ec.cart.getCart(ec.cart.initCartTableAndRecommend);
    ec.cart.refreshRecover();
    var b = getUrlParaMap4CartBinding();
    var a = b.isSuccess;
    if (null != a && "0" == a) {
        bindCartResult("ec-binding-phone")
    }
});
